<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Digital Scrapbook</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Jua&family=Dongle:wght@300;400;700&family=Hi+Melody&family=Gaegu&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* 기본 스타일 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f7f7f7;
            font-size: 16px;
            overflow: hidden;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 메인 컨테이너 */
        .app-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 헤더 (툴바) */
        header {
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        .tools {
            display: flex;
            gap: 10px;
        }

        .tool-btn {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .tool-btn:hover {
            background-color: #e0e0e0;
        }

        .tool-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        /* 메인 캔버스 영역 */
        .canvas-area {
            flex-grow: 1;
            position: relative;
            background-color: #e8e6e1; /* 종이 질감 */
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAACzKpkBAAAAG0lEQVR42mP4//8/w38GIAXDjOAMwhgAEgEAIC9ohtx6xXUAAAAASUVORK5CYII='); /* 미세한 종이 질감 패턴 */
            overflow: hidden;
        }

        /* 스크랩북 아이템 */
        .scrapbook-item {
            position: absolute;
            transform-origin: 50% 50%;
            touch-action: none;
            cursor: grab;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }
        
        .scrapbook-item.active {
            border-color: #007bff;
            z-index: 100;
        }

        .item-content {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* 이미지 아이템 */
        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.1) contrast(1.1) saturate(1.2);
            mix-blend-mode: multiply; /* 필름 그레인 효과를 위한 블렌딩 */
        }
        
        .item-image.vintage::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://grain-generator.s3.amazonaws.com/grain-3.png');
            opacity: 0.1;
            mix-blend-mode: overlay;
        }
        
        /* 텍스트 아이템 */
        .item-text {
            border: none;
            background: rgba(255, 255, 255, 0.7);
            resize: none;
            width: 100%;
            height: 100%;
            padding: 10px;
            outline: none;
            font-size: 18px;
            line-height: 1.4;
        }

        /* 크기 조절 핸들 */
        .resize-handle {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: #007bff;
            border: 2px solid white;
            border-radius: 50%;
            right: -8px;
            bottom: -8px;
            cursor: nwse-resize;
            opacity: 0;
            pointer-events: none;
        }

        .scrapbook-item.active .resize-handle {
            opacity: 1;
            pointer-events: auto;
        }

        /* 회전 핸들 */
        .rotate-handle {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: #007bff;
            border: 2px solid white;
            border-radius: 50%;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            cursor: crosshair;
            opacity: 0;
            pointer-events: none;
        }

        .scrapbook-item.active .rotate-handle {
            opacity: 1;
            pointer-events: auto;
        }

        /* 글씨체 선택 메뉴 */
        .font-selector {
            position: absolute;
            top: 50px;
            left: 20px;
            background: #fff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none; /* 초기 숨김 */
            z-index: 200;
        }

        .font-selector span {
            display: block;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 16px;
        }

        .font-selector span:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="logo">My Scrapbook</div>
            <div class="tools">
                <button id="addPhotoBtn" class="tool-btn">사진 추가</button>
                <button id="addTextBtn" class="tool-btn">텍스트 추가</button>
                <button id="saveBtn" class="tool-btn">저장</button>
                <input type="file" id="photoInput" accept="image/*" style="display:none;">
            </div>
        </header>
        <div class="canvas-area" id="canvasArea">
            </div>
    </div>
    
    <script>
        const canvasArea = document.getElementById('canvasArea');
        const addPhotoBtn = document.getElementById('addPhotoBtn');
        const addTextBtn = document.getElementById('addTextBtn');
        const saveBtn = document.getElementById('saveBtn');
        const photoInput = document.getElementById('photoInput');
        
        let activeItem = null;
        let isDragging = false;
        let isResizing = false;
        let isRotating = false;
        
        // 폰트 목록
        const fonts = [
            'Noto Sans KR',
            'Nanum Pen Script',
            'Jua',
            'Dongle',
            'Hi Melody'
        ];

        document.addEventListener('DOMContentLoaded', () => {
            addPhotoBtn.addEventListener('click', () => photoInput.click());
            addTextBtn.addEventListener('click', addTextItem);
            
            canvasArea.addEventListener('mousedown', (e) => {
                if (!e.target.closest('.scrapbook-item')) {
                    if (activeItem) {
                        activeItem.classList.remove('active');
                        activeItem = null;
                    }
                }
            });
            
            photoInput.addEventListener('change', handlePhotoUpload);
        });

        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    addPhotoItem(event.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function addPhotoItem(src) {
            const itemEl = document.createElement('div');
            itemEl.className = 'scrapbook-item';
            itemEl.style.width = '250px';
            itemEl.style.height = '250px';
            itemEl.style.left = `${(canvasArea.offsetWidth / 2) - 125}px`;
            itemEl.style.top = `${(canvasArea.offsetHeight / 2) - 125}px`;

            const imgEl = document.createElement('img');
            imgEl.src = src;
            imgEl.className = 'item-image vintage';
            itemEl.appendChild(imgEl);
            
            // 크기 조절 및 회전 핸들 추가
            itemEl.innerHTML += `
                <div class="resize-handle"></div>
                <div class="rotate-handle"></div>
            `;
            
            canvasArea.appendChild(itemEl);
            setupInteractions(itemEl);
        }
        
        function addTextItem() {
            const itemEl = document.createElement('div');
            itemEl.className = 'scrapbook-item';
            itemEl.style.width = '200px';
            itemEl.style.height = '100px';
            itemEl.style.left = `${(canvasArea.offsetWidth / 2) - 100}px`;
            itemEl.style.top = `${(canvasArea.offsetHeight / 2) - 50}px`;
            
            const textEl = document.createElement('textarea');
            textEl.className = 'item-text';
            textEl.value = '새로운 텍스트';
            textEl.style.fontFamily = `'${fonts[0]}'`;
            itemEl.appendChild(textEl);
            
            // 텍스트 편집기 기능
            textEl.addEventListener('focus', (e) => {
                showFontSelector(e.target);
            });
            textEl.addEventListener('blur', () => {
                setTimeout(hideFontSelector, 200);
            });

            // 크기 조절 및 회전 핸들 추가
            itemEl.innerHTML += `
                <div class="resize-handle"></div>
                <div class="rotate-handle"></div>
            `;
            
            canvasArea.appendChild(itemEl);
            setupInteractions(itemEl);
        }
        
        function setupInteractions(itemEl) {
            let initialX, initialY, initialMouseX, initialMouseY, initialAngle, initialWidth, initialHeight;

            itemEl.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('resize-handle')) {
                    isResizing = true;
                    e.stopPropagation();
                    initialMouseX = e.clientX;
                    initialMouseY = e.clientY;
                    initialWidth = itemEl.offsetWidth;
                    initialHeight = itemEl.offsetHeight;
                } else if (e.target.classList.contains('rotate-handle')) {
                    isRotating = true;
                    e.stopPropagation();
                    const rect = itemEl.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    const dx = e.clientX - centerX;
                    const dy = e.clientY - centerY;
                    initialAngle = Math.atan2(dy, dx) * 180 / Math.PI - (getRotation(itemEl) || 0);
                } else {
                    isDragging = true;
                    e.stopPropagation();
                    initialX = itemEl.offsetLeft;
                    initialY = itemEl.offsetTop;
                    initialMouseX = e.clientX;
                    initialMouseY = e.clientY;
                }
                
                if (activeItem) {
                    activeItem.classList.remove('active');
                }
                activeItem = itemEl;
                activeItem.classList.add('active');
            });
            
            canvasArea.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const dx = e.clientX - initialMouseX;
                    const dy = e.clientY - initialMouseY;
                    itemEl.style.left = `${initialX + dx}px`;
                    itemEl.style.top = `${initialY + dy}px`;
                }
                if (isResizing) {
                    const dx = e.clientX - initialMouseX;
                    const dy = e.clientY - initialMouseY;
                    itemEl.style.width = `${Math.max(initialWidth + dx, 50)}px`;
                    itemEl.style.height = `${Math.max(initialHeight + dy, 50)}px`;
                }
                if (isRotating) {
                    const rect = itemEl.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    const dx = e.clientX - centerX;
                    const dy = e.clientY - centerY;
                    const newAngle = Math.atan2(dy, dx) * 180 / Math.PI;
                    const rotation = newAngle - initialAngle;
                    itemEl.style.transform = `rotate(${rotation}deg)`;
                }
            });

            canvasArea.addEventListener('mouseup', () => {
                isDragging = false;
                isResizing = false;
                isRotating = false;
            });
        }
        
        function getRotation(element) {
            const style = window.getComputedStyle(element, null);
            const transform = style.getPropertyValue('transform');
            if (transform === 'none') return 0;
            const matrix = transform.split('(')[1].split(')')[0].split(',');
            const a = matrix[0];
            const b = matrix[1];
            return Math.round(Math.atan2(b, a) * (180 / Math.PI));
        }

        function showFontSelector(targetTextarea) {
            let fontSelector = document.querySelector('.font-selector');
            if (!fontSelector) {
                fontSelector = document.createElement('div');
                fontSelector.className = 'font-selector';
                fonts.forEach(font => {
                    const span = document.createElement('span');
                    span.textContent = font;
                    span.style.fontFamily = `'${font}'`;
                    span.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        targetTextarea.style.fontFamily = `'${font}'`;
                        hideFontSelector();
                    });
                    fontSelector.appendChild(span);
                });
                document.body.appendChild(fontSelector);
            }
            const rect = targetTextarea.getBoundingClientRect();
            fontSelector.style.top = `${rect.bottom + 5}px`;
            fontSelector.style.left = `${rect.left}px`;
            fontSelector.style.display = 'block';
        }

        function hideFontSelector() {
            const fontSelector = document.querySelector('.font-selector');
            if (fontSelector) {
                fontSelector.style.display = 'none';
            }
        }

        saveBtn.addEventListener('click', () => {
            alert('저장 기능이 구현되었습니다!');
            // 실제로는 서버에 데이터를 전송하는 로직이 들어갑니다.
            // 예시: localStorage.setItem('scrapbookData', JSON.stringify(items));
        });
    </script>
</body>
</html>